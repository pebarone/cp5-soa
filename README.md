# Sistema de Reserva de Hotel üè®
<img width="1569" height="896" alt="image" src="https://github.com/user-attachments/assets/8bca2f10-2f1e-4a90-8c52-054a7c4b4dce" />

## Integrantes do Grupo
- Nome: Pedro Augusto Carneiro Barone Bomfim - RM: 99781 
- Nome: Jo√£o Pedro de Albuquerque Oliveira - RM: 551579
- Nome: Matheus Augusto Santos Rego - RM:551466

## Como usar?
A aplica√ß√£o tem um deploy no google cloud run, para uso sem necessidade de configura√ß√£o local: https://cp5-soa-xmsmzoghiq-rj.a.run.app

Mas, mais abaixo, h√° tamb√©m uma explica√ß√£o de como configurar o ambiente para execu√ß√£o em servidor de desenvolvimento.

A documenta√ß√£o dos endpoints pode ser encontrada aqui: https://cp5-soa-xmsmzoghiq-rj.a.run.app/api-docs

## üìã Descri√ß√£o

Sistema completo de gerenciamento de reservas de hotel desenvolvido como Checkpoint 2 da disciplina de Arquitetura Orientada a Servi√ßos da FIAP. O projeto implementa uma API REST seguindo padr√µes de arquitetura MVC em 3 camadas, com regras de neg√≥cio robustas para gest√£o do ciclo completo: **reserva ‚Üí check-in ‚Üí check-out**.

## üéØ Funcionalidades Principais

### Gest√£o de H√≥spedes
- Cadastro completo com valida√ß√£o de CPF
- Atualiza√ß√£o de dados pessoais
- Consulta individual e listagem
- Exclus√£o com verifica√ß√£o de reservas ativas

### Gest√£o de Quartos
- Cadastro com tipos (STANDARD, DELUXE, SUITE)
- Defini√ß√£o de capacidade e pre√ßo por di√°ria
- Ativa√ß√£o/desativa√ß√£o de quartos
- Valida√ß√£o de disponibilidade no per√≠odo

### Gest√£o de Reservas
- **Cria√ß√£o**: Valida√ß√£o de disponibilidade, datas e capacidade
- **Atualiza√ß√£o**: Permitida apenas no status CREATED
- **Check-in**: Com valida√ß√£o de janela (apenas no dia previsto)
- **Check-out**: C√°lculo autom√°tico do valor final baseado em di√°rias efetivas
- **Cancelamento**: Permitido apenas antes do check-in
- **Filtros**: Por h√≥spede ou quarto

### Interface Web
- Dashboard responsivo e intuitivo
- Gerenciamento visual de reservas, h√≥spedes e quartos
- Filtros din√¢micos e a√ß√µes contextuais
- Feedback visual com anima√ß√µes e toasts

## üèóÔ∏è Arquitetura

O projeto segue arquitetura **MVC em 3 camadas** com separa√ß√£o clara de responsabilidades:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   CAMADA DE APRESENTA√á√ÉO                ‚îÇ
‚îÇ  Controllers (Express) + DTOs + Valida√ß√£o de Entrada    ‚îÇ
‚îÇ  ‚Ä¢ guest.controller.js                                  ‚îÇ
‚îÇ  ‚Ä¢ room.controller.js                                   ‚îÇ
‚îÇ  ‚Ä¢ reservation.controller.js                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  CAMADA DE NEG√ìCIO                      ‚îÇ
‚îÇ     Services (Regras de Neg√≥cio + L√≥gica)               ‚îÇ
‚îÇ  ‚Ä¢ guest.service.js                                     ‚îÇ
‚îÇ  ‚Ä¢ room.service.js                                      ‚îÇ
‚îÇ  ‚Ä¢ reservation.service.js                               ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 CAMADA DE PERSIST√äNCIA                  ‚îÇ
‚îÇ      Repositories (Acesso a Dados + Queries)            ‚îÇ
‚îÇ  ‚Ä¢ guest.repository.js                                  ‚îÇ
‚îÇ  ‚Ä¢ room.repository.js                                   ‚îÇ
‚îÇ  ‚Ä¢ reservation.repository.js                            ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Padr√µes Implementados

- **DTOs**: Separa√ß√£o entre dados de entrada/sa√≠da e modelos internos
- **Repository Pattern**: Abstra√ß√£o de acesso a dados
- **Service Layer**: Encapsulamento de regras de neg√≥cio
- **Error Handling**: Middleware centralizado com erros customizados
- **Dependency Injection**: M√≥dulos isolados e test√°veis

## üìÅ Estrutura do Projeto

```
cp5-soa/
‚îú‚îÄ‚îÄ app.js                      # Ponto de entrada da aplica√ß√£o
‚îú‚îÄ‚îÄ package.json                # Depend√™ncias e scripts
‚îú‚îÄ‚îÄ jest.config.js              # Configura√ß√£o de testes
‚îú‚îÄ‚îÄ .env                        # Vari√°veis de ambiente (n√£o versionado)
‚îÇ
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îú‚îÄ‚îÄ knexfile.js            # Configura√ß√£o do Knex para migra√ß√µes
‚îÇ   ‚îú‚îÄ‚îÄ safe-migrate.js        # Script de migra√ß√£o seguro
‚îÇ   ‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ V1__init.sql       # Script de cria√ß√£o das tabelas Oracle
‚îÇ   ‚îî‚îÄ‚îÄ seeds/
‚îÇ       ‚îî‚îÄ‚îÄ seed.js            # Dados iniciais (10 h√≥spedes, 10 quartos, 10 reservas)
‚îÇ
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ database.js        # Pool de conex√µes Oracle
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ swagger.yaml       # Documenta√ß√£o OpenAPI 3.0
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ controllers/           # Camada de apresenta√ß√£o
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guest.controller.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ room.controller.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ reservation.controller.js
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ services/              # Camada de neg√≥cio
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guest.service.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ room.service.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ reservation.service.js
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ repositories/          # Camada de persist√™ncia
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guest.repository.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ room.repository.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ reservation.repository.js
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ dtos/                  # Data Transfer Objects
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guest.dto.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ room.dto.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ reservation.dto.js
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ models/                # Modelos de dom√≠nio
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guest.model.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ room.model.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ reservation.model.js
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ routes/                # Defini√ß√£o de rotas
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.js           # Router principal
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ guest.routes.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ room.routes.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ reservation.routes.js
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ middlewares/           # Middlewares customizados
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ errorHandler.js    # Tratamento global de erros
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ validation.middleware.js
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îî‚îÄ‚îÄ dateUtils.js       # Utilit√°rios de manipula√ß√£o de datas
‚îÇ
‚îú‚îÄ‚îÄ static/                    # Interface web (SPA)
‚îÇ   ‚îú‚îÄ‚îÄ index.html             # P√°gina principal
‚îÇ   ‚îú‚îÄ‚îÄ styles.css             # Estilos globais
‚îÇ   ‚îú‚îÄ‚îÄ app.js                 # Core da aplica√ß√£o frontend
‚îÇ   ‚îú‚îÄ‚îÄ api.js                 # Camada de comunica√ß√£o com API
‚îÇ   ‚îú‚îÄ‚îÄ guests.js              # M√≥dulo de h√≥spedes
‚îÇ   ‚îú‚îÄ‚îÄ rooms.js               # M√≥dulo de quartos
‚îÇ   ‚îú‚îÄ‚îÄ reservations.js        # M√≥dulo de reservas
‚îÇ   ‚îî‚îÄ‚îÄ animations.js          # Anima√ß√µes e transi√ß√µes
‚îÇ
‚îî‚îÄ‚îÄ test/                      # Testes automatizados
    ‚îú‚îÄ‚îÄ controllers/
    ‚îÇ   ‚îî‚îÄ‚îÄ guest.controller.test.js
    ‚îú‚îÄ‚îÄ services/
    ‚îÇ   ‚îî‚îÄ‚îÄ reservation.service.test.js
    ‚îú‚îÄ‚îÄ repositories/
    ‚îÇ   ‚îî‚îÄ‚îÄ room.repository.test.js
    ‚îî‚îÄ‚îÄ utils/
        ‚îî‚îÄ‚îÄ dateUtils.test.js
```

## üöÄ Instala√ß√£o e Execu√ß√£o

### Pr√©-requisitos

- **Node.js** >= 18.x
- **npm** ou **pnpm**
- **Oracle Database** 19c ou superior (ou acesso a Oracle Cloud)
- **Docker** (opcional, para execu√ß√£o em container)

### Op√ß√£o 1: Executar com Docker üê≥ (Recomendado)

A forma mais r√°pida de executar a aplica√ß√£o √© usando Docker:

#### 1.1. Pull da Imagem do Docker Hub

```bash
docker pull pbrnx/cp5-soa:latest
```

#### 1.2. Configure as Vari√°veis de Ambiente

Crie um arquivo `.env` na raiz do projeto:

```env
# Configura√ß√£o do Banco de Dados Oracle
DB_USER=seu_usuario
DB_PASSWORD=sua_senha
# Configura√ß√£o do Banco de Dados Oracle
DB_USER=seu_usuario
DB_PASSWORD=sua_senha
DB_URL=localhost:1521/ORCL

# Porta da aplica√ß√£o (opcional, padr√£o: 3000)
PORT=3000

# Seed autom√°tico ao iniciar (opcional, padr√£o: false)
AUTO_SEED=true
```

#### 1.3. Execute com Docker Run

```bash
# Com seed autom√°tico (recomendado para primeira execu√ß√£o)
docker run -d \
  --name hotel-reservations-api \
  -p 3000:3000 \
  -e DB_USER=seu_usuario \
  -e DB_PASSWORD=sua_senha \
  -e DB_URL=localhost:1521/XEPDB1 \
  -e AUTO_SEED=true \
  pbrnx/cp5-soa:latest

# Ou usando arquivo .env
docker run -d --name hotel-reservations-api -p 3000:3000 --env-file .env pbrnx/cp5-soa:latest
```

> **üí° Dica**: O container automaticamente:
> - Aguarda o banco de dados estar pronto
> - Inicia a aplica√ß√£o
> - Executa o seed se `AUTO_SEED=true` (popula com 10 h√≥spedes, 10 quartos, 10 reservas)

#### 1.4. Ou Use Docker Compose

```bash
# Inicia o container com seed autom√°tico
docker-compose up -d

# Ver logs em tempo real
docker-compose logs -f
```

A aplica√ß√£o estar√° dispon√≠vel em:
- **API**: http://localhost:3000/api
- **Interface Web**: http://localhost:3000
- **Documenta√ß√£o Swagger**: http://localhost:3000/api-docs

#### Comandos Docker √öteis

```bash
# Ver logs do container (√∫til para acompanhar o seed)
docker logs -f hotel-reservations-api

# Ver valor do AUTO_SEED e outras env vars
docker exec hotel-reservations-api env | grep AUTO_SEED

# Ver logs apenas do seed
docker logs hotel-reservations-api | grep "üå±"

# Parar o container
docker stop hotel-reservations-api

# Remover o container
docker rm hotel-reservations-api

# Reiniciar (importante: pare e remova para recarregar .env)
docker-compose down
docker-compose up -d

# Ver status e health check
docker ps
docker inspect hotel-reservations-api | grep -A 5 Health
```
docker ps
```

### Op√ß√£o 2: Executar Localmente

#### 2.1. Clone o Reposit√≥rio

```bash
git clone https://github.com/pebarone/cp5-soa.git
cd cp5-soa
```

#### 2.2. Instale as Depend√™ncias

```bash
npm install
# ou
pnpm install
```

#### 2.3. Configure as Vari√°veis de Ambiente

Crie um arquivo `.env` na raiz do projeto:

```env
# Configura√ß√£o do Banco de Dados Oracle
DB_USER=seu_usuario
DB_PASSWORD=sua_senha
DB_URL=localhost:1521/ORCL

# Porta da aplica√ß√£o (opcional, padr√£o: 3000)
PORT=3000
```

#### 2.4. Execute as Migra√ß√µes do Banco de Dados

As migra√ß√µes s√£o executadas automaticamente ao iniciar a aplica√ß√£o com `npm start`, mas voc√™ tamb√©m pode execut√°-las manualmente:

```bash
npm run migrate
```

Este comando usa o Knex para aplicar todas as migra√ß√µes pendentes de forma segura.

#### 2.5. Inicie a Aplica√ß√£o
```bash
npm start
```

A aplica√ß√£o estar√° dispon√≠vel em:
- **API**: http://localhost:3000/api
- **Interface Web**: http://localhost:3000
- **Documenta√ß√£o Swagger**: http://localhost:3000/api-docs

### 3. Popule o Banco com Dados Iniciais (Opcional)

Com a aplica√ß√£o rodando, execute o script de seed:

```bash
node db/seeds/seed.js
```

Isso criar√°:
- 10 h√≥spedes com CPFs v√°lidos
- 10 quartos de diferentes tipos
- 10 reservas de exemplo

## üîÑ Migra√ß√µes Versionadas (Knex.js)

O projeto utiliza **Knex.js** para gerenciar migra√ß√µes de banco de dados de forma versionada e rastre√°vel. Todas as migra√ß√µes s√£o executadas automaticamente no startup da aplica√ß√£o.

### Estrutura de Migra√ß√µes

```
db/
‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îú‚îÄ‚îÄ 20250127000001_init.js      # Cria√ß√£o inicial das tabelas
‚îÇ   ‚îú‚îÄ‚îÄ 20250127000002_example.js   # Exemplo de migra√ß√£o futura
‚îÇ   ‚îî‚îÄ‚îÄ 20250127000003_feature.js   # Exemplo de migra√ß√£o futura
‚îú‚îÄ‚îÄ knexfile.js                      # Configura√ß√£o do Knex
‚îî‚îÄ‚îÄ seeds/                           # Seeds separados das migra√ß√µes
    ‚îî‚îÄ‚îÄ seed.js
```

### Conven√ß√£o de Nomenclatura

As migra√ß√µes seguem o padr√£o Knex (timestamp):
- **Prefixo**: Timestamp (YYYYMMDDHHmmss)
- **Separador**: `_` (underscore)
- **Descri√ß√£o**: Nome descritivo em snake_case
- **Extens√£o**: `.js`

Exemplos:
- `20250127000001_init.js` - Cria√ß√£o inicial
- `20250127000002_add_guest_address.js` - Adiciona coluna de endere√ßo
- `20250127000003_create_payments.js` - Cria tabela de pagamentos

### Comandos Dispon√≠veis

```bash
# Executar migra√ß√µes pendentes
npm run migrate

# Ver status de todas as migra√ß√µes
npm run migrate:status

# Reverter √∫ltima migra√ß√£o (rollback)
npm run migrate:rollback

# Criar nova migra√ß√£o
npm run migrate:make nome_da_migracao
```

### Execu√ß√£o Autom√°tica no Docker

O `docker-entrypoint.sh` executa automaticamente as migra√ß√µes no startup:

```bash
1. Aguarda o banco de dados estar pronto
2. Executa migra√ß√µes pendentes (npm run migrate)
3. Inicia a aplica√ß√£o
4. Executa seed se AUTO_SEED=true
```

### Hist√≥rico de Migra√ß√µes

O Knex mant√©m um registro de todas as migra√ß√µes executadas na tabela `knex_migrations`:

| Id | Name | Batch | Migration Time |
|----|------|-------|----------------|
| 1 | 20250127000001_init.js | 1 | 2025-01-15 10:30:00 |

### Como Criar uma Nova Migra√ß√£o

1. Crie um arquivo em `db/migrations/` seguindo a conven√ß√£o usando o comando:
   ```bash
   npm run migrate:make add_guest_address
   ```
   
   Isso criar√° um arquivo como: `20250127000002_add_guest_address.js`

2. Escreva a migra√ß√£o usando Knex:
   ```javascript
   exports.up = async function(knex) {
     await knex.schema.table('RESERVAS_GUESTS', (table) => {
       table.string('address', 200);
     });
   };

   exports.down = async function(knex) {
     await knex.schema.table('RESERVAS_GUESTS', (table) => {
       table.dropColumn('address');
     });
   };
   ```

3. A migra√ß√£o ser√° executada automaticamente no pr√≥ximo deploy ou via comando:
   ```bash
   npm run migrate
   ```

### Boas Pr√°ticas

‚úÖ **FA√áA:**
- Sempre crie migra√ß√µes incrementais
- Use nomes descritivos
- Teste migra√ß√µes localmente antes de comitar
- Nunca modifique migra√ß√µes j√° aplicadas em produ√ß√£o

‚ùå **N√ÉO FA√áA:**
- Alterar migra√ß√µes j√° executadas
- Usar comandos destrutivos (DROP, TRUNCATE) sem backup
- Pular n√∫meros de vers√£o

### Rollback

O Knex suporta rollback atrav√©s do comando `npm run migrate:rollback`, que reverter√° o √∫ltimo batch de migra√ß√µes. Para reverter mudan√ßas espec√≠ficas, voc√™ tamb√©m pode criar uma nova migra√ß√£o com as altera√ß√µes inversas:

```javascript
// Exemplo: 20250127000003_revert_add_guest_address.js
exports.up = async function(knex) {
  await knex.schema.table('RESERVAS_GUESTS', (table) => {
    table.dropColumn('address');
  });
};

exports.down = async function(knex) {
  await knex.schema.table('RESERVAS_GUESTS', (table) => {
    table.string('address', 200);
  });
};
```

## üß™ Testes

O projeto inclui testes automatizados usando **Jest**:

```bash
# Executar todos os testes
npm test

# Executar testes espec√≠ficos
npm test -- guest.controller.test.js
```

**Cobertura de testes:**
- Controllers (valida√ß√£o de fluxo HTTP)
- Services (regras de neg√≥cio)
- Repositories (queries SQL)
- Utils (manipula√ß√£o de datas)

## üì° API Endpoints

### H√≥spedes (Guests)

| M√©todo | Endpoint | Descri√ß√£o |
|--------|----------|-----------|
| `POST` | `/api/guests` | Cria novo h√≥spede |
| `GET` | `/api/guests` | Lista todos os h√≥spedes |
| `GET` | `/api/guests/:id` | Busca h√≥spede por ID |
| `PUT` | `/api/guests/:id` | Atualiza h√≥spede |
| `DELETE` | `/api/guests/:id` | Remove h√≥spede |

### Quartos (Rooms)

| M√©todo | Endpoint | Descri√ß√£o |
|--------|----------|-----------|
| `POST` | `/api/rooms` | Cria novo quarto |
| `GET` | `/api/rooms` | Lista todos os quartos |
| `GET` | `/api/rooms/:id` | Busca quarto por ID |
| `PUT` | `/api/rooms/:id` | Atualiza quarto |
| `PATCH` | `/api/rooms/:id/activate` | Ativa quarto |
| `PATCH` | `/api/rooms/:id/deactivate` | Desativa quarto |

### Reservas (Reservations)

| M√©todo | Endpoint | Descri√ß√£o |
|--------|----------|-----------|
| `POST` | `/api/reservations` | Cria nova reserva |
| `GET` | `/api/reservations` | Lista reservas (com filtros) |
| `GET` | `/api/reservations/:id` | Busca reserva por ID |
| `PUT` | `/api/reservations/:id` | Atualiza datas da reserva |
| `PATCH` | `/api/reservations/:id/check-in` | Realiza check-in |
| `PATCH` | `/api/reservations/:id/check-out` | Realiza check-out |
| `PATCH` | `/api/reservations/:id/cancel` | Cancela reserva |

### Exemplos de Requisi√ß√µes

#### Criar H√≥spede
```bash
curl -X POST http://localhost:3000/api/guests \
  -H "Content-Type: application/json" \
  -d '{
    "fullName": "Jo√£o Silva",
    "document": "12345678901",
    "email": "joao@example.com",
    "phone": "11999999999"
  }'
```

#### Criar Reserva
```bash
curl -X POST http://localhost:3000/api/reservations \
  -H "Content-Type: application/json" \
  -d '{
    "guestId": "uuid-do-hospede",
    "roomId": "uuid-do-quarto",
    "checkinExpected": "2025-11-10",
    "checkoutExpected": "2025-11-15"
  }'
```

#### Realizar Check-in
```bash
curl -X PATCH http://localhost:3000/api/reservations/{id}/check-in
```

## üîí Regras de Neg√≥cio Implementadas

### Valida√ß√µes de Data
- ‚úÖ `checkoutExpected` deve ser posterior a `checkinExpected`
- ‚úÖ Viola√ß√£o retorna `400 Bad Request`

### Disponibilidade de Quarto
- ‚úÖ N√£o permite sobreposi√ß√£o de reservas no mesmo quarto
- ‚úÖ Reservas canceladas n√£o bloqueiam disponibilidade
- ‚úÖ Viola√ß√£o retorna `409 Conflict`

### Capacidade
- ‚úÖ N√∫mero de h√≥spedes n√£o pode exceder capacidade do quarto
- ‚úÖ Viola√ß√£o retorna `400 Bad Request`

### M√°quina de Estados (FSM)
```
CREATED ‚Üí CHECKED_IN ‚Üí CHECKED_OUT
   ‚Üì
CANCELED
```
- ‚úÖ Transi√ß√µes inv√°lidas retornam `409 Conflict`
- ‚úÖ Cancelamento permitido apenas no status CREATED

### Janela de Check-in
- ‚úÖ Check-in permitido apenas no dia de `checkinExpected`
- ‚úÖ Viola√ß√£o retorna `422 Unprocessable Entity`

### C√°lculo de Valores
- ‚úÖ Valor estimado calculado na cria√ß√£o da reserva
- ‚úÖ Valor final calculado no check-out baseado em di√°rias efetivas
- ‚úÖ F√≥rmula: `valorFinal = max(1, diasEfetivos) √ó pre√ßoPorNoite`

### Preserva√ß√£o de Pre√ßo
- ‚úÖ Pre√ßo da di√°ria √© fixado no momento da reserva (`pricePerNightAtBooking`)
- ‚úÖ Altera√ß√µes futuras no pre√ßo do quarto n√£o afetam reservas existentes

## üìä Modelo de Dados

### Diagrama ER Simplificado

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ     GUESTS      ‚îÇ         ‚îÇ  RESERVATIONS   ‚îÇ         ‚îÇ      ROOMS      ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§         ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§         ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ id (PK)         ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ guest_id (FK)   ‚îÇ         ‚îÇ id (PK)         ‚îÇ
‚îÇ full_name       ‚îÇ         ‚îÇ room_id (FK)    ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ number (UNIQUE) ‚îÇ
‚îÇ document (UQ)   ‚îÇ         ‚îÇ checkin_expected‚îÇ         ‚îÇ type            ‚îÇ
‚îÇ email (UQ)      ‚îÇ         ‚îÇ checkout_expected‚îÇ        ‚îÇ capacity        ‚îÇ
‚îÇ phone           ‚îÇ         ‚îÇ status          ‚îÇ         ‚îÇ price_per_night ‚îÇ
‚îÇ created_at      ‚îÇ         ‚îÇ checkin_at      ‚îÇ         ‚îÇ status          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ checkout_at     ‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ priceat_booking ‚îÇ
                            ‚îÇ estimated_amount‚îÇ
                            ‚îÇ final_amount    ‚îÇ
                            ‚îÇ created_at      ‚îÇ
                            ‚îÇ updated_at      ‚îÇ
                            ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Enumera√ß√µes

**Room.type**: `STANDARD` | `DELUXE` | `SUITE`  
**Room.status**: `ATIVO` | `INATIVO`  
**Reservation.status**: `CREATED` | `CHECKED_IN` | `CHECKED_OUT` | `CANCELED`

## üõ†Ô∏è Stack Tecnol√≥gica

### Backend
- **Node.js** 18+ (Runtime)
- **Express** 5.x (Framework web)
- **oracledb** 6.x (Driver Oracle Database)
- **express-validator** (Valida√ß√£o de dados)
- **helmet** (Seguran√ßa HTTP)
- **dotenv** (Vari√°veis de ambiente)
- **uuid** (Gera√ß√£o de IDs √∫nicos)

### Frontend
- **Vanilla JavaScript** (ES6+)
- **HTML5** / **CSS3**
- **Fetch API** (Comunica√ß√£o com backend)

### Documenta√ß√£o
- **Swagger UI** + **OpenAPI 3.0**
- **YAML** (Defini√ß√£o da API)

### Testes
- **Jest** 30.x (Framework de testes)
- **Supertest** (Testes de integra√ß√£o HTTP)

### Banco de Dados
- **Oracle Database** 19c+
- **Migra√ß√µes versionadas** (SQL scripts)

## üé® Interface Web

A aplica√ß√£o inclui uma interface web completa e responsiva:

### Dashboard
- Navega√ß√£o entre m√≥dulos (H√≥spedes, Quartos, Reservas)
- Estat√≠sticas e cards informativos
- Design moderno com anima√ß√µes suaves

### Funcionalidades da Interface
- ‚úÖ CRUD completo de h√≥spedes e quartos
- ‚úÖ Gest√£o visual de reservas com filtros
- ‚úÖ A√ß√µes contextuais (check-in, check-out, cancelamento)
- ‚úÖ Modais para cria√ß√£o/edi√ß√£o/visualiza√ß√£o
- ‚úÖ Valida√ß√£o de formul√°rios em tempo real
- ‚úÖ Feedback visual com toasts e estados de loading
- ‚úÖ Tratamento de erros amig√°vel

## üìù Decis√µes Arquiteturais (ADRs)

### ADR-001: Arquitetura em 3 Camadas (MVC)

**Contexto**: Necessidade de separa√ß√£o clara de responsabilidades e manutenibilidade.

**Decis√£o**: Implementar padr√£o MVC com 3 camadas distintas:
- **Controller**: Valida√ß√£o de entrada, transforma√ß√£o de DTOs
- **Service**: Regras de neg√≥cio, orquestra√ß√£o
- **Repository**: Acesso a dados, queries SQL

**Consequ√™ncias**:
- ‚úÖ C√≥digo mais test√°vel e modular
- ‚úÖ Facilita manuten√ß√£o e evolu√ß√£o
- ‚ö†Ô∏è Maior complexidade inicial

### ADR-002: Oracle Database com Pool de Conex√µes

**Contexto**: Necessidade de persist√™ncia robusta e perform√°tica.

**Decis√£o**: Usar Oracle Database com pool de conex√µes gerenciado por `oracledb`.

**Configura√ß√£o**:
- Pool m√≠nimo: 2 conex√µes
- Pool m√°ximo: 4 conex√µes
- Timeout: 60 segundos

**Consequ√™ncias**:
- ‚úÖ Alta performance e escalabilidade
- ‚úÖ Reutiliza√ß√£o eficiente de conex√µes
- ‚ö†Ô∏è Requer Oracle Instant Client instalado

### ADR-003: DTOs para Entrada/Sa√≠da

**Contexto**: Evitar exposi√ß√£o de modelos internos e melhorar valida√ß√£o.

**Decis√£o**: Implementar DTOs separados para requisi√ß√µes e respostas.

**Consequ√™ncias**:
- ‚úÖ Controle fino sobre dados expostos
- ‚úÖ Valida√ß√£o centralizada
- ‚úÖ Versionamento de API facilitado

### ADR-004: Containeriza√ß√£o com Docker

**Contexto**: Facilitar deploy e garantir ambiente consistente.

**Decis√£o**: Criar imagem Docker otimizada com multi-stage build.

**Implementa√ß√£o**:
- Base image: `node:18-alpine` (lightweight)
- Multi-stage build para reduzir tamanho final
- Usu√°rio n√£o-root para seguran√ßa
- Health check integrado
- Dispon√≠vel no Docker Hub: `pbrnx/cp5-soa`

**Consequ√™ncias**:
- ‚úÖ Deploy simplificado e port√°vel
- ‚úÖ Ambiente consistente (dev/prod)
- ‚úÖ Imagem otimizada (~400MB)
- ‚úÖ F√°cil escalabilidade
- ‚úÖ Seed autom√°tico configur√°vel

## üê≥ Docker

### Informa√ß√µes da Imagem

- **Docker Hub**: [pbrnx/cp5-soa](https://hub.docker.com/r/pbrnx/cp5-soa)
- **Tags dispon√≠veis**: 
  - `latest` - Vers√£o mais recente
  - `v1.0` - Vers√£o est√°vel 1.0
- **Tamanho**: ~400MB
- **Base**: Node.js 18 Alpine Linux

### Caracter√≠sticas Principais

- ‚úÖ **Seed Autom√°tico**: Popula o banco automaticamente na primeira execu√ß√£o
- ‚úÖ **Health Check**: Verifica se a aplica√ß√£o est√° respondendo
- ‚úÖ **Wait for Database**: Aguarda o banco estar pronto antes de iniciar
- ‚úÖ **Usu√°rio n√£o-root**: Executa com usu√°rio nodejs (1001)
- ‚úÖ **Multi-stage build**: Imagem otimizada
- ‚úÖ **Logs estruturados**: Com emojis para f√°cil visualiza√ß√£o

### Vari√°veis de Ambiente

| Vari√°vel | Obrigat√≥ria | Padr√£o | Descri√ß√£o |
|----------|-------------|--------|-----------|
| `DB_USER` | ‚úÖ | - | Usu√°rio do Oracle Database |
| `DB_PASSWORD` | ‚úÖ | - | Senha do Oracle Database |
| `DB_URL` | ‚úÖ | - | String de conex√£o (host:port/service) |
| `PORT` | ‚ùå | 3000 | Porta da aplica√ß√£o |
| `NODE_ENV` | ‚ùå | production | Ambiente Node.js |
| `AUTO_SEED` | ‚ùå | false | Executar seed ao iniciar |

### Build Local

Para fazer build da imagem localmente:

```bash
# Build com m√∫ltiplas tags
docker build -t pbrnx/cp5-soa:v1.0 -t pbrnx/cp5-soa:latest .

# Verificar imagem criada
docker images | grep cp5-soa
```

### Push para Docker Hub

```bash
# Login no Docker Hub
docker login

# Push das tags
docker push pbrnx/cp5-soa:v1.0
docker push pbrnx/cp5-soa:latest
```

### Caracter√≠sticas da Imagem

- ‚úÖ Multi-stage build para otimiza√ß√£o
- ‚úÖ Apenas depend√™ncias de produ√ß√£o
- ‚úÖ Usu√°rio n√£o-root (nodejs:1001)
- ‚úÖ Health check configurado (30s interval)
- ‚úÖ Baseada em Alpine Linux (m√≠nima)
- ‚úÖ Entrypoint inteligente com:
  - Verifica√ß√£o de conex√£o com banco
  - Inicializa√ß√£o da aplica√ß√£o
  - Seed autom√°tico opcional
  - Logs estruturados

### Processo de Inicializa√ß√£o

Quando o container √© iniciado, o seguinte processo ocorre:

1. üöÄ **Start**: Container inicia
2. ‚è≥ **Wait for DB**: Aguarda conex√£o com Oracle estar dispon√≠vel
3. üåü **Start App**: Inicia o servidor Node.js em background
4. ‚è≥ **Wait Ready**: Aguarda aplica√ß√£o estar pronta (~10s)
5. üå± **Run Seed** (se `AUTO_SEED=true`): Popula banco de dados
6. ‚úÖ **Ready**: Aplica√ß√£o pronta para receber requisi√ß√µes

Voc√™ pode acompanhar todo esse processo nos logs:
```bash
docker logs -f hotel-reservations-api
```

## üêõ Tratamento de Erros

A aplica√ß√£o implementa tratamento robusto de erros com:

### Erros Customizados
- `NotFoundError` (404): Recurso n√£o encontrado
- `ValidationError` (400): Dados inv√°lidos
- `ConflictError` (409): Viola√ß√£o de regra de neg√≥cio
- `ForbiddenError` (403): A√ß√£o n√£o permitida
- `UnprocessableEntityError` (422): Fora da pol√≠tica

### Payload Padronizado
```json
{
  "status": "error",
  "message": "Descri√ß√£o clara do erro",
  "errors": [
    {
      "field": "campo",
      "message": "mensagem espec√≠fica"
    }
  ],
  "timestamp": "2025-10-23T12:00:00.000Z"
}
```

## üîß Status Codes HTTP Utilizados

| C√≥digo | Uso |
|--------|-----|
| `200 OK` | Sucesso em GET, PUT, PATCH |
| `201 Created` | Recurso criado com sucesso |
| `204 No Content` | Sucesso sem corpo de resposta |
| `400 Bad Request` | Valida√ß√£o de dados falhou |
| `404 Not Found` | Recurso n√£o encontrado |
| `409 Conflict` | Conflito de neg√≥cio (ex: quarto indispon√≠vel) |
| `422 Unprocessable Entity` | Fora de pol√≠tica (ex: check-in antecipado) |
| `500 Internal Server Error` | Erro inesperado do servidor |

## üë• Autores

**Grupo CP5-SOA**
- Pedro Barone (@pebarone)
- [Adicione os outros membros do grupo aqui]

**Disciplina**: Arquitetura Orientada a Servi√ßos (3ESPY)  
**Institui√ß√£o**: FIAP  
**Professora**: Damiana Costa  
**Ano**: 2025

## üìÑ Licen√ßa

Este projeto √© um trabalho acad√™mico desenvolvido para fins educacionais.

---

‚≠ê **Checkpoint 2 - Sistema de Reserva de Hotel** | FIAP 3ESPY 2025
